<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIDI Controller C3</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; background: #1a1a1a; color: white; }
        button { width: 220px; height: 120px; font-size: 1.8rem; font-weight: bold; cursor: pointer; border-radius: 20px; border: none; background: #007AFF; color: white; box-shadow: 0 6px 15px rgba(0,0,0,0.3); touch-action: manipulation; }
        button:active { background: #0051a8; transform: scale(0.95); }
        #status { margin-top: 30px; font-size: 0.9rem; color: #aaa; text-align: center; padding: 0 20px; }
    </style>
</head>
<body>

    <button id="playBtn">C3 (Ch 1)</button>
    <div id="status">MIDIデバイスを待機中...</div>

    <script>
        let midiOutput = null;

        // MIDIアクセスのリクエスト
        if (navigator.requestMIDIAccess) {
            navigator.requestMIDIAccess()
                .then(onMIDISuccess, () => {
                    document.getElementById('status').innerText = "MIDIアクセスが拒否されました。HTTPSで接続しているか確認してください。";
                });
        } else {
            document.getElementById('status').innerText = "お使いのブラウザはWeb MIDI APIをサポートしていません。Chromeをお試しください。";
        }

        function onMIDISuccess(midiAccess) {
            updateOutputs(midiAccess);
            midiAccess.onstatechange = () => updateOutputs(midiAccess);
        }

        function updateOutputs(midiAccess) {
            const outputs = Array.from(midiAccess.outputs.values());
            if (outputs.length > 0) {
                midiOutput = outputs[0];
                document.getElementById('status').innerText = `接続中: ${midiOutput.name}`;
            } else {
                midiOutput = null;
                document.getElementById('status').innerText = "MIDIデバイスが見つかりません。USBインターフェースを接続してください。";
            }
        }

        const playBtn = document.getElementById('playBtn');

        // Note ON (C3 = 60, Channel 1 = 0x90)
        playBtn.addEventListener('pointerdown', (e) => {
            e.preventDefault();
            if (midiOutput) {
                midiOutput.send([0x90, 60, 100]); 
            }
        });

        // Note OFF (C3 = 60, Channel 1 = 0x80)
        playBtn.addEventListener('pointerup', (e) => {
            e.preventDefault();
            if (midiOutput) {
                midiOutput.send([0x80, 60, 0]);
            }
        });
    </script>
</body>
</html>
